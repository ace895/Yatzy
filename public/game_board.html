<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Yatzy</title>
    <meta name="viewport" content="width=device-width">
    <script  src="assets/yatzy_engine.js"></script>
    <script type="module" src="assets/dice.js"></script>
    <script type="module" src="assets/yatzy_game.js"></script>
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>
    <center><h1>YATZY</h1></center>
    <div class="row">
        <div id="dice-board">
            <table id="dice-table">
                <tr>
                    <td class="dice-td"><div class="dice" id="die1" onclick="select(document.getElementById('die1'))" onload="showNDie(document.getElementById('die1'), 6)"></div></td>
                    <td class="dice-td"></td>
                    <td class="dice-td"><div class="dice" id="die2" onclick="select(document.getElementById('die2'))" onload="showNDie(document.getElementById('die2'), 6)"></div></td>
                </tr>
                <tr>
                    <td class="dice-td"></td>
                    <td class="dice-td"><div class="dice" id="die3" onclick="select(document.getElementById('die3'))" onload="showNDie(document.getElementById('die3'), 6)"></div></td>
                    <td class="dice-td"></td>
                </tr>
                <tr>
                    <td class="dice-td"><div class="dice" id="die4" onclick="select(document.getElementById('die4'))" onload="showNDie(document.getElementById('die4'), 6)"></div></td>
                    <td class="dice-td"></td>
                    <td class="dice-td"><div class="dice" id="die5" onclick="select(document.getElementById('die5'))" onload="showNDie(document.getElementById('die5'), 6)"></div></td>
                </tr>
            </table>
            <button id="roll-button" onclick="rollAll()"><b>Roll</b></button>
            <p id="instructions" class="instructions">Click a dice to select it for a reroll and click "Reroll" <br>OR<br> Select a score box to submit a score</p>
        </div>
    
        <div id="score-board">
            <div id="upper-score-board">
                <table id="score-table">
                    <thead>
                        <tr>
                            <td class="score-td">Upper Section</td>
                        </tr>
                        <tr>
                            <td class="score-td"><b>Category</b></td>
                            <td class="score-td"><b>How to Score</b></td>
                            <td class="score-td"><b>Score</b></td>
                        </tr> 
                    </thead>
                    <tbody>
                        <tr>
                            <td class="score-td">Aces</td>
                            <td class="score-td">Count and add only Aces</td>
                            <td class="score" id="aces-score" onclick="submitScore('aces-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Twos</td>
                            <td class="score-td">Count and add only Twos</td>
                            <td class="score" id="twos-score" onclick="submitScore('twos-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Threes</td>
                            <td class="score-td">Count and add only Threes</td>
                            <td class="score" id="threes-score" onclick="submitScore('threes-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Fours</td>
                            <td class="score-td">Count and add only Aces</td>
                            <td class="score" id="fours-score" onclick="submitScore('fours-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Fives</td>
                            <td class="score-td">Count and add only Twos</td>
                            <td class="score" id="fives-score" onclick="submitScore('fives-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Sixes</td>
                            <td class="score-td">Count and add only Threes</td>
                            <td class="score" id="sixes-score" onclick="submitScore('sixes-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Total Score</td>
                            <td class="score-td"></td>
                            <td class="score-td" id="upper-subtotal-score"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Bonus if total score is >= 63</td>
                            <td class="score-td">Score 35</td>
                            <td class="score-td" id="upper-bonus-score"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Total of Upper Section</td>
                            <td class="score-td"></td>
                            <td class="score-td" id="upper-total-score"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        
            <br>
            <div id="lower-score-board">
                <table id="score-table">
                    <thead>
                        <tr><td class="score-td">Lower Section</td></tr>
                        <tr>
                            <td class="score-td"><b>Category</b></td>
                            <td class="score-td"><b>How to Score</b></td>
                            <td class="score-td"><b>Score</b></td>
                        </tr> 
                    </thead>
                    <tbody>
                        <tr>
                            <td class="score-td">3 of a kind</td>
                            <td class="score-td">Add total of all dice</td>
                            <td class="score" id="three-of-a-kind-score" onclick="submitScore('three-of-a-kind-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">4 of a kind</td>
                            <td class="score-td">Add total of all dice</td>
                            <td class="score" id="four-of-a-kind-score" onclick="submitScore('four-of-a-kind-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Full house</td>
                            <td class="score-td">Score 25</td>
                            <td class="score" id="full-house-score" onclick="submitScore('full-house-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Small straight (sequence of 4)</td>
                            <td class="score-td">Score 30</td>
                            <td class="score" id="sm-straight-score" onclick="submitScore('sm-straight-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Long straight (sequence of 5)</td>
                            <td class="score-td">Score 40</td>
                            <td class="score" id="lg-straight-score" onclick="submitScore('lg-straight-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">YAHTZEE (5 of a kind)</td>
                            <td class="score-td">Score 50</td>
                            <td class="score" id="yahtzee-score" onclick="submitScore('yahtzee-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Chance</td>
                            <td class="score-td">Add total of all dice</td>
                            <td class="score" id="chance-score" onclick="submitScore('chance-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Bonus if total score is >= 63</td>
                            <td class="score-td">Score 35</td>
                            <td class="score-td" id="lower-bonus-score"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Total of Lower Section</td>
                            <td class="score-td"></td>
                            <td class="score-td" id="lower-total-score"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Grand Total</td>
                            <td class="score-td"></td>
                            <td class="score-td" id="total-score"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
 </body>

<script>
    var selectedColor = "rgb(255, 238, 107)";
    var unselectedColor = "rgb(255, 255, 255)";

    //Roll (or reroll) all dice
    function rollAll() {
        button = document.getElementById("roll-button");
        if (button.innerHTML == "<b>Reroll</b>") {
            reroll(game.dice);
        }
        else {
            dice = game.rollDice()
            displayDice(dice);
            button.innerHTML = "<b>Reroll</b>";
            document.getElementById("instructions").style.visibility = "visible";
        }
    
    }

    //Change the selection of die
    function select(die) {
        if (document.getElementById("roll-button").innerHTML == "<b>Roll</b>") {
            return;
        }
        else {
            //Check if die is selected
            if (die.style.backgroundColor == unselectedColor || die.style.backgroundColor == "") {
                die.style.backgroundColor = selectedColor;
            }
            else {
                die.style.backgroundColor = unselectedColor;
            }
        }
    }

    //Change innerHTML of die to show number n
    function showNDie(die, n) {
        if (n == 1) {
            die.innerHTML = "<div class=\"middle\"><div class=\"dot\"></div></div>";
        }
        else if (n == 2) {
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>";
        }
        else if (n == 3) {
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"middle\"><div class=\"dot\"></div></div>" ;
        }
        else if (n == 4) {
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"top-right\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-left\"><div class=\"dot\"></div></div>" +
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>" ;
        }
        else if (n == 5) {
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"top-right\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-left\"><div class=\"dot\"></div></div>" +
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>" +
                            "<div class=\"middle\"><div class=\"dot\"></div></div>" ;
        }
        else if (n==6){
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"top-right\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-left\"><div class=\"dot\"></div></div>" +
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>" +
                            "<div class=\"middle-right\"><div class=\"dot\"></div></div>" +
                            "<div class=\"middle-left\"><div class=\"dot\"></div></div>" ;
        }

    }
    
    //Show rolling animation and set dice face to n
    function showRoll(die, n) {
        var i = 0;
        var roller = setInterval(() => {
            i ++;
            showNDie(die, Math.floor(Math.random() * 6) + 1);
            if (i > 15) {
                showNDie(die, n);
                clearInterval(roller);
            }
        }, 50);
        
    }
    
    function displayDice(dice) {
        for (let i = 0; i < dice.length; i++) {
            showRoll(document.getElementById("die1"),  dice[i]);
        }
        calculatePossibleScore(dice);
    }

    //Reroll selected die
    function reroll(dice) {
        //Check which die are selected and reroll them
        diceSelected = false;
        const diceToReroll = []; 

        console.log(document.getElementById("die1").style.backgroundColor );
        if (document.getElementById("die1").style.backgroundColor == selectedColor) {
            diceToReroll.push(0);
            select(document.getElementById("die1"));
            diceSelected = true;
        }
        if (document.getElementById("die2").style.backgroundColor == selectedColor) {
            diceToReroll.push(1);
            select(document.getElementById("die2"));
            diceSelected = true;
        }
        if (document.getElementById("die3").style.backgroundColor == selectedColor) {
            diceToReroll.push(2);
            select(document.getElementById("die3"));
            diceSelected = true;
        }
        if (document.getElementById("die4").style.backgroundColor == selectedColor) {
            diceToReroll.push(3);
            select(document.getElementById("die4"));
            diceSelected = true;
        }
        if (document.getElementById("die5").style.backgroundColor == selectedColor) {
            diceToReroll.push(4);
            select(document.getElementById("die5"));
            diceSelected = true;
        }
        if (diceSelected) {
            //Decrement rerolls
            const reroll_dice = game.reroll(diceToReroll);
            let count = 0; 
            for(let i = 0; i < 5; i++){
                if(i === diceToReroll[count]){
                    dice[i] = reroll_dice[count];
                    count++; 
                }

            }
            displayDice(dice);
        }
        else {
            document.getElementById("instructions").innerHTML = "Select a dice first to reroll!";
        }
    }


    function submitScore(Category) {
        //Get dice values and calculate score
        dices =[document.getElementById("die1").childElementCount, document.getElementById("die2").childElementCount,document.getElementById("die3").childElementCount,document.getElementById("die4").childElementCount,document.getElementById("die5").childElementCount];
        console.log(document.getElementById("die1").childElementCount);
        calculateScore(dices, Category);
    }

    //Reset board objects for next turn
    function resetBoard() {
        //Reset instructions
        instructionBox = document.getElementById("instructions");
        instructionBox.style.visibility = "hidden";
        instructionBox.innerHTML = "Click a dice to select it for a reroll and click \"Reroll\" <br>OR<br> Select a score box to submit a score";
        
        //Reset button
        document.getElementById("roll-button").innerHTML = "<b>Roll</b>";

        //Reset dice
        document.getElementById("die1").style.backgroundColor = unselectedColor;
        document.getElementById("die2").style.backgroundColor = unselectedColor;
        document.getElementById("die3").style.backgroundColor = unselectedColor;
        document.getElementById("die4").style.backgroundColor = unselectedColor;
        document.getElementById("die5").style.backgroundColor = unselectedColor;
    }

    //Ends the current game
    function endGame() {
        sessionStorage.score = JSON.stringify(finalScore); //send the final score to the end page
        window.location.href = "end_page.html";
    }
    var game = new Game();
    window.onload = function() {
       
        game.start_game();
        showNDie(document.getElementById('die1'), 6);
        showNDie(document.getElementById('die2'), 6);
        showNDie(document.getElementById('die3'), 6);
        showNDie(document.getElementById('die4'), 6);
        showNDie(document.getElementById('die5'), 6);
        
    };

</script>

</html>