<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Yatzy</title>
    <meta name="viewport" content="width=device-width">
    <script src="assets/yatzy_engine.js"></script>
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>
    <div class="header">
        <h1 id="title">YATZY</h1>
        <a href="https://www.hasbro.com/common/instruct/yahtzee.pdf" target="_blank">
            <button id="how-to-play"><b>How to Play</b></button>
        </a>
    </div>
    
    <hr>
    <div class="row">
        <div id="dice-board">
            <table id="dice-table">
                <tr>
                    <td class="dice-td"><div class="dice" id="die1" onclick="select(document.getElementById('die1'))"></div></td>
                    <td class="dice-td"></td>
                    <td class="dice-td"><div class="dice" id="die2" onclick="select(document.getElementById('die2'))"></div></td>
                </tr>
                <tr>
                    <td class="dice-td"></td>
                    <td class="dice-td"><div class="dice" id="die3" onclick="select(document.getElementById('die3'))"></div></td>
                    <td class="dice-td"></td>
                </tr>
                <tr>
                    <td class="dice-td"><div class="dice" id="die4" onclick="select(document.getElementById('die4'))"></div></td>
                    <td class="dice-td"></td>
                    <td class="dice-td"><div class="dice" id="die5" onclick="select(document.getElementById('die5'))"></div></td>
                </tr>
            </table>
            <button id="roll-button" onclick="rollAll()"><b>Roll</b></button>
            <p id="instructions" class="instructions">Click a dice to select it for a reroll and click "Reroll" <br>OR<br> Select a score box to submit a score</p>
        </div>
    
        <div id="score-board">
            <div id="upper-score-board">
                <table id="score-table">
                    <thead>
                        <tr>
                            <td class="score-td" id="upper-title"><b>UPPER SECTION</b></td>
                        </tr>
                        <tr>
                            <td class="score-td"><b>Category</b></td>
                            <td class="score-td"><b>How to Score</b></td>
                            <td class="score-td"><b>Score</b></td>
                        </tr> 
                    </thead>
                    <tbody>
                        <tr>
                            <td class="score-td">Aces</td>
                            <td class="score-td">Count and add only Aces</td>
                            <td class="score" id="aces-score" onclick="submitScore('aces-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Twos</td>
                            <td class="score-td">Count and add only Twos</td>
                            <td class="score" id="twos-score" onclick="submitScore('twos-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Threes</td>
                            <td class="score-td">Count and add only Threes</td>
                            <td class="score" id="threes-score" onclick="submitScore('threes-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Fours</td>
                            <td class="score-td">Count and add only Aces</td>
                            <td class="score" id="fours-score" onclick="submitScore('fours-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Fives</td>
                            <td class="score-td">Count and add only Twos</td>
                            <td class="score" id="fives-score" onclick="submitScore('fives-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Sixes</td>
                            <td class="score-td">Count and add only Threes</td>
                            <td class="score" id="sixes-score" onclick="submitScore('sixes-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Total Score</td>
                            <td class="score-td"></td>
                            <td class="score-td" id="upper-subtotal-score"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Bonus if total score is >= 63</td>
                            <td class="score-td">Score 35</td>
                            <td class="score-td" id="upper-bonus-score"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Total of Upper Section</td>
                            <td class="score-td"></td>
                            <td class="score-td" id="upper-total-score"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        
            <br>
            <div id="lower-score-board">
                <table id="score-table">
                    <thead>
                        <tr><td class="score-td" id="lower-title"><b>LOWER SECTION</b></td></tr>
                        <tr>
                            <td class="score-td"><b>Category</b></td>
                            <td class="score-td"><b>How to Score</b></td>
                            <td class="score-td"><b>Score</b></td>
                        </tr> 
                    </thead>
                    <tbody>
                        <tr>
                            <td class="score-td">3 of a kind</td>
                            <td class="score-td">Add total of all dice</td>
                            <td class="score" id="three-of-a-kind-score" onclick="submitScore('three-of-a-kind-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">4 of a kind</td>
                            <td class="score-td">Add total of all dice</td>
                            <td class="score" id="four-of-a-kind-score" onclick="submitScore('four-of-a-kind-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Full house</td>
                            <td class="score-td">Score 25</td>
                            <td class="score" id="full-house-score" onclick="submitScore('full-house-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Small straight (sequence of 4)</td>
                            <td class="score-td">Score 30</td>
                            <td class="score" id="sm-straight-score" onclick="submitScore('sm-straight-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Long straight (sequence of 5)</td>
                            <td class="score-td">Score 40</td>
                            <td class="score" id="lg-straight-score" onclick="submitScore('lg-straight-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">YAHTZEE (5 of a kind)</td>
                            <td class="score-td">Score 50</td>
                            <td class="score" id="yahtzee-score" onclick="submitScore('yahtzee-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Chance</td>
                            <td class="score-td">Add total of all dice</td>
                            <td class="score" id="chance-score" onclick="submitScore('chance-score')"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Bonus if total score is >= 63</td>
                            <td class="score-td">Score 35</td>
                            <td class="score-td" id="lower-bonus-score"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Total of Lower Section</td>
                            <td class="score-td"></td>
                            <td class="score-td" id="lower-total-score"></td>
                        </tr>
                        <tr>
                            <td class="score-td">Grand Total</td>
                            <td class="score-td"></td>
                            <td class="score-td" id="total-score"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
 </body>

<script>
    var selectedColor = "rgb(255, 238, 107)";
    var unselectedColor = "rgb(255, 255, 255)";

    //Roll (or reroll) all dice
    function rollAll() {
        button = document.getElementById("roll-button");
        if (button.innerHTML == "<b>Reroll</b>") {
            reroll();
        }
        else {
            Game.roll();
            displayDice([0, 1, 2, 3, 4]);
            button.innerHTML = "<b>Reroll</b>";
            document.getElementById("instructions").style.visibility = "visible";
        }
        
    }

    //Change the selection of die
    function select(die) {
        if (document.getElementById("roll-button").innerHTML == "<b>Roll</b>") {
            return;
        }
        else {
            //Check if die is selected
            if (die.style.backgroundColor == unselectedColor || die.style.backgroundColor == "") {
                die.style.backgroundColor = selectedColor;
            }
            else {
                die.style.backgroundColor = unselectedColor;
            }
        }
    }

    //Change innerHTML of die to show number n
    function showNDie(die, n) {
        if (n == 1) {
            die.innerHTML = "<div class=\"middle\"><div class=\"dot\"></div></div>";
        }
        else if (n == 2) {
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>";
        }
        else if (n == 3) {
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"middle\"><div class=\"dot\"></div></div>" ;
        }
        else if (n == 4) {
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"top-right\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-left\"><div class=\"dot\"></div></div>" +
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>" ;
        }
        else if (n == 5) {
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"top-right\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-left\"><div class=\"dot\"></div></div>" +
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>" +
                            "<div class=\"middle\"><div class=\"dot\"></div></div>" ;
        }
        else if (n==6){
            die.innerHTML = "<div class=\"top-left\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"top-right\"><div class=\"dot\"></div></div>" + 
                            "<div class=\"bottom-left\"><div class=\"dot\"></div></div>" +
                            "<div class=\"bottom-right\"><div class=\"dot\"></div></div>" +
                            "<div class=\"middle-right\"><div class=\"dot\"></div></div>" +
                            "<div class=\"middle-left\"><div class=\"dot\"></div></div>" ;
        }

    }
    
    //Show rolling animation and set dice face to n
    function showRoll(die, n) {
        var i = 0;
        var roller = setInterval(() => {
            i ++;
            showNDie(die, Math.floor(Math.random() * 6) + 1);
            if (i > 15) {
                showNDie(die, n);
                clearInterval(roller);
            }
        }, 50);
        
    }
    
    function displayDice(dice) {
        for (let i = 0; i < dice.length; i++) {
            n = dice[i];
            showRoll(document.getElementById("die" + (n + 1)),  Game.dice[n]);
        }
        calculatePossibleScore(Game.get_dice());
    }

    //Reroll selected die
    function reroll() {
        //Check which die are selected
        diceSelected = false;
        const diceToReroll = []; 
        if(Game.get_rerolls() >= 2){
            
        }else{
            if (document.getElementById("die1").style.backgroundColor == selectedColor) {
                diceToReroll.push(0);
                select(document.getElementById("die1"));
                diceSelected = true;
            }
            if (document.getElementById("die2").style.backgroundColor == selectedColor) {
                diceToReroll.push(1);
                select(document.getElementById("die2"));
                diceSelected = true;
            }
            if (document.getElementById("die3").style.backgroundColor == selectedColor) {
                diceToReroll.push(2);
                select(document.getElementById("die3"));
                diceSelected = true;
            }
            if (document.getElementById("die4").style.backgroundColor == selectedColor) {
                diceToReroll.push(3);
                select(document.getElementById("die4"));
                diceSelected = true;
            }
            if (document.getElementById("die5").style.backgroundColor == selectedColor) {
                diceToReroll.push(4);
                select(document.getElementById("die5"));
                diceSelected = true;
            }

            //Reroll die
            Game.reroll(diceToReroll);
            displayDice(diceToReroll);
            if(!diceSelected) {
                document.getElementById("instructions").innerHTML = "Select a dice first to reroll!";
            }
        }

    }

    function submitScore(Category) {
        //Get dice values and calculate score
        var able_to_accept = calculateScore(Game.get_dice(), Category);
        //see if they can keep going or not 
        if(able_to_accept){
            remove_possible_calculation(); 
            resetBoard();
        }else{

        }
        if(document.getElementById("aces-score").innerHTML !== "" && document.getElementById("twos-score").innerHTML !== "" && document.getElementById("threes-score").innerHTML !== "" && document.getElementById("fours-score").innerHTML !== "" && 
            document.getElementById("fives-score").innerHTML !== "" && document.getElementById("sixes-score").innerHTML !== "" && document.getElementById("three-of-a-kind-score").innerHTML !== "" && document.getElementById("four-of-a-kind-score").innerHTML !== "" && 
            document.getElementById("yahtzee-score").innerHTML !== "" && document.getElementById("sm-straight-score").innerHTML !== "" && document.getElementById("lg-straight-score").innerHTML !== "" && document.getElementById("full-house-score").innerHTML !== "" && document.getElementById("chance-score").innerHTML !== ""){
            updateOverallScore(); 
            endGame();
        }
    }

    //Reset board objects for next turn
    function resetBoard() {
        //Reset instructions
        instructionBox = document.getElementById("instructions");
        instructionBox.style.visibility = "hidden";
        instructionBox.innerHTML = "Click a dice to select it for a reroll and click \"Reroll\" <br>OR<br> Select a score box to submit a score";
        
        //Reset button
        document.getElementById("roll-button").innerHTML = "<b>Roll</b>";

        //Reset dice
        document.getElementById("die1").style.backgroundColor = unselectedColor;
        document.getElementById("die2").style.backgroundColor = unselectedColor;
        document.getElementById("die3").style.backgroundColor = unselectedColor;
        document.getElementById("die4").style.backgroundColor = unselectedColor;
        document.getElementById("die5").style.backgroundColor = unselectedColor;
    }

    //Ends the current game
    function endGame() {
        sessionStorage.score = JSON.stringify( document.getElementById("total-score").innerHTML); //send the final score to the end page
        window.location.href = "end_page.html";
    }

    window.onload = function() {
       
        showNDie(document.getElementById('die1'), 6);
        showNDie(document.getElementById('die2'), 6);
        showNDie(document.getElementById('die3'), 6);
        showNDie(document.getElementById('die4'), 6);
        showNDie(document.getElementById('die5'), 6);
        
    };

</script>

</html>